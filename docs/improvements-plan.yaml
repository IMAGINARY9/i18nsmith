# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# i18nsmith â€” Comprehensive Improvements Plan
# Generated: 2026-02-11
# Source: external-test-data analysis (bilinmenu React/Next.js project)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

meta:
  project_under_test: bilinmenu (React/Next.js, 86 source files)
  config_file: external-test-data/i18n.config.json
  artifacts_analyzed:
    - transform-preview.txt    # 2237 additions â€” massive false-positive pollution
    - bulk-rename-preview.txt  # 12 renames â€” incorrect key relocations
    - i18nsmith-dynamic-keys-resolution.md  # manual workaround report
  sync_status: working correctly (confirmed by user)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PART 1 â€” CRITICAL BUGS (transform-preview analysis)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

critical_bugs:

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # BUG-1: CSS/Tailwind class strings extracted as translatable text
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: BUG-1
    title: "CSS/Tailwind class strings pass through text-filter heuristic"
    severity: critical
    status: completed
    affects: [transform, check]
    frameworks: [react, vue]  # global fix needed
    
    evidence:
      description: |
        The transform-preview shows ~1500+ false-positive keys where Tailwind/CSS
        class strings are extracted as translatable text. These appear as keys like:
          "...flex-items-center-gap.71e9be": "flex items-center gap-2 text-sm..."
          "...rounded-2xl-border-border.27739d": "rounded-2xl border border-[var(...)]..."
          "...w-full-px-3.44567f": "w-full px-3 py-2 border border-[var(...)]..."
        This is the single largest issue â€” over 60% of the 2237 proposed additions
        are Tailwind/CSS class strings that should never be extracted.
      
      sample_false_positives:
        - "flex items-center gap-2 text-sm font-semibold text-[var(--color-muted-foreground)]"
        - "mb-1 block text-sm font-semibold text-[var(--color-foreground)]"
        - "w-full rounded-2xl border border-[var(--color-border)] bg-[var(--color-muted)]..."
        - "animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"
        - "p-4 sm:p-6 border-b border-[var(--color-border)]"
    
    root_cause: |
      The CSS_CLASS_PATTERN regex in text-filters.ts is:
        /^(?:[\w:./\-\[\]]+\s+)+[\w:./\-\[\]]+$/i
      Combined with CSS_CLASS_SIGNAL: /[-:\[\]/\d]/
      
      This fails for many real Tailwind strings because:
      1. The pattern requires ONLY space-separated tokens with restricted chars,
         but Tailwind uses parentheses in arbitrary values: `text-[var(--color-x)]`
         The `(` and `)` characters are NOT in the character class [\w:./\-\[\]]
      2. Complex Tailwind classes with `()` like `bg-[var(--color-primary)]/90`,
         `hover:bg-[var(--color-primary)]/90`, `focus:ring-[var(--color-primary)]/20`
         break the regex because of unmatched chars
      3. Responsive prefixes with colons work (`sm:`, `md:`, `lg:`) but combined
         with arbitrary values they fall through
      
      Additionally, the filter only runs on the TEXT content â€” but the real issue
      is that these strings come from JSX expression contexts (className={...})
      where the Scanner's processJsxExpressions method scans ALL string literals
      inside JSX expressions. The className attribute is NOT in the
      DEFAULT_TRANSLATABLE_ATTRIBUTES set, but the expression scanner doesn't check
      the parent attribute name at scan-time â€” it only checks at transform-time
      via the Transformer's guardrail.
      
      The Transformer DOES have a guardrail that checks the parent attribute
      (line ~665 in transformer.ts), but the Scanner doesn't, so the candidates
      still appear in preview/check output.

    fix:
      approach: "Multi-layer fix â€” both scan-time filtering and improved heuristic"
      
      changes:
        - file: packages/core/src/framework/utils/text-filters.ts
          what: "Improve CSS_CLASS_PATTERN to handle Tailwind arbitrary values"
          detail: |
            Replace the current regex with a more robust detection:
            1. Add parentheses to allowed chars: [\w:./\-\[\](),'#%]
            2. Add a secondary heuristic: if a string contains 3+ space-separated
               tokens AND matches common Tailwind patterns (responsive prefixes,
               state variants, arbitrary values), classify as CSS
            3. Add explicit Tailwind signal patterns:
               - /\b(flex|grid|block|inline|hidden|absolute|relative|fixed|sticky)\b/
               - /\b(bg|text|border|rounded|shadow|ring|outline|p|m|w|h|gap|space)-/
               - /\b(hover|focus|active|disabled|dark|sm|md|lg|xl|2xl):/
               - /\bvar\(--/
            4. Add a new "looks like CSS class list" composite check that triggers
               when multiple Tailwind utility signals are present
        
        - file: packages/core/src/framework/ReactAdapter.ts
          what: "Add parent-attribute check in scanJsxExpressions"
          detail: |
            In scanJsxExpressions(), when iterating stringLiterals inside a
            JsxExpression, check if the JsxExpression's parent is a JsxAttribute.
            If so, check if that attribute name is in translatableAttributes.
            If NOT, skip the string literal entirely (don't even create a candidate).
            
            This mirrors the Transformer's guardrail but applies it at scan-time,
            preventing false positives from appearing in preview output.
            
            Code sketch:
            ```
            // Before processing string literals in JSX expression:
            const exprParent = jsxExpr.getParent();
            if (Node.isJsxAttribute(exprParent)) {
              const attrName = exprParent.getNameNode().getText();
              if (!this.translatableAttributes.has(attrName)) {
                continue; // skip entire expression
              }
            }
            ```
        
        - file: packages/core/src/framework/adapters/vue.ts
          what: "Apply same parent-attribute check for Vue expressions"
          detail: |
            Ensure Vue adapter also skips extraction from non-translatable
            attribute bindings (:class, :style, etc.)
      
      tests:
        - "CSS class string 'flex items-center gap-2 text-sm' â†’ NOT extracted"
        - "CSS with arbitrary values 'text-[var(--color-primary)]' â†’ NOT extracted"
        - "Complex Tailwind 'bg-[var(--color-card)] rounded-xl shadow-2xl border' â†’ NOT extracted"
        - "Real text 'Loading delicious menu...' â†’ still extracted"
        - "Mixed: className expression strings are never candidates"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # BUG-2: Non-translatable technical strings extracted
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: BUG-2
    title: "SVG path data, icon names, CSS custom properties, and code artifacts extracted"
    severity: critical
    status: completed
    affects: [transform, check]
    frameworks: [react, vue]
    
    evidence:
      description: |
        The transform-preview shows hundreds of false positives for:
        
        a) SVG path data (d attribute values):
           "M11 5H6a2 2 0 00-2 2v11a2 2 0 002..."
           "M12 6v6m0 0v6m0-6h6m-6 0H6"
           "M19 7l-.867 12.142A2 2 0..."
        
        b) Icon library identifiers:
           "mdi:email-fast-outline", "mdi:check-circle", "mdi:loading"
        
        c) CSS custom property names:
           "--color-foreground", "--color-muted", "--font-primary"
        
        d) CSS values (px, auto, etc.):
           "10px", "200px", "0 auto", "0.5px", "bold", "center", "baseline"
        
        e) Code/technical strings:
           "submit", "text", "button", "checkbox", "radio", "password"
           "evenodd", "currentColor", "noopener noreferrer"
           "ORDER_ITEM_STATUS_UPDATED", "ORDER_STATUS_UPDATED"
        
        f) URL paths:
           "/dashboard/billing", "/client/orders", "/auth/forgot-password"
           "/?auth=required"
        
        g) Console.log/debug messages:
           "âœ… Logo updated from server:", "ğŸ“¤ Logo upload callback received URL:"
           "Form submitted with data:", "Setting showAddItem to:"
        
        h) HTML input types as values:
           "text", "email", "password", "submit", "tel", "date", "time"
      
      sample_false_positives:
        - "M19 11H5m14 0a2 2 0 012 2v6..."    # SVG path
        - "mdi:email-send"                       # icon name
        - "--color-accent-foreground"             # CSS var
        - "10px"                                  # CSS value
        - "evenodd"                               # SVG fill-rule
        - "/dashboard/billing"                    # URL path
        - "ORDER_STATUS_UPDATED"                  # event/enum constant
    
    root_cause: |
      Multiple gaps in text-filters.ts heuristics:
      1. SVG `d` attribute values pass through because they contain letters mixed
         with numbers, and the CSS class pattern doesn't match SVG path syntax
      2. Icon identifiers like "mdi:check-circle" have letters and pass the
         letter-ratio check
      3. CSS custom properties "--color-*" start with dashes but contain letters
      4. The URL_PATTERN only checks for http/https/mailto/tel schemes, missing
         relative paths starting with /
      5. SCREAMING_SNAKE_CASE constants pass all filters
      6. Debug/console messages with emoji pass all filters
      7. Short technical values ("text", "button", "submit") are real English
         words so can't be filtered by letter content alone â€” they need
         CONTEXT-AWARE filtering (i.e., knowing they're inside a `type` or `value`
         or `name` attribute)
    
    fix:
      approach: "Add specialized deny heuristics + context propagation"
      
      changes:
        - file: packages/core/src/framework/utils/text-filters.ts
          what: "Add new detection patterns"
          detail: |
            Add these new patterns/checks to shouldExtractText():
            
            1. SVG path data detection:
               const SVG_PATH_PATTERN = /^[MmLlHhVvCcSsQqTtAaZz\d\s.,\-]+$/;
               Skip if matches AND string length > 20
            
            2. Icon identifier detection:
               const ICON_IDENTIFIER_PATTERN = /^[a-z][\w-]*:[a-z][\w-]*$/i;
               (matches "mdi:check", "lucide:arrow-right", etc.)
            
            3. CSS custom property detection:
               const CSS_CUSTOM_PROP_PATTERN = /^--[\w-]+$/;
            
            4. CSS unit value detection:
               const CSS_UNIT_PATTERN = /^\d+(\.\d+)?(px|em|rem|vh|vw|%|s|ms|fr)$/;
               const CSS_SHORTHAND_PATTERN = /^[\d.]+(px|em|rem|%)(\s+[\d.]+(px|em|rem|%))*$/;
            
            5. Relative URL path detection:
               const RELATIVE_PATH_PATTERN = /^\/[\w\-./]+(\?[\w=&]*)?$/;
            
            6. SCREAMING_SNAKE_CASE constant detection:
               const CONSTANT_PATTERN = /^[A-Z][A-Z0-9_]+$/;
            
            7. Console/debug message detection (starts with emoji):
               const DEBUG_MESSAGE_PATTERN = /^[\u{1F300}-\u{1F9FF}]/u;
            
            8. HTML event handler pattern:
               const EVENT_NAME_PATTERN = /^on[A-Z]\w+$/;

        - file: packages/core/src/framework/ReactAdapter.ts
          what: "Propagate attribute context to expression scanner"
          detail: |
            When scanning JSX expressions that are children of JSX attributes,
            propagate the attribute name as context. The text filter can then
            use this context to make smarter decisions:
            - Inside `type` attr â†’ skip "text", "submit", "button", etc.
            - Inside `icon` attr â†’ skip icon identifiers
            - Inside `d` attr â†’ skip SVG paths
            - Inside `viewBox` attr â†’ skip coordinates
            
            This requires extending ScanCandidate to optionally carry
            `attributeContext?: string` so downstream filters can use it.

      tests:
        - "SVG path 'M19 7l-.867 12.142A2...' â†’ NOT extracted"
        - "Icon 'mdi:email-send' â†’ NOT extracted"
        - "CSS var '--color-foreground' â†’ NOT extracted"
        - "CSS value '10px' â†’ NOT extracted"
        - "URL path '/dashboard/billing' â†’ NOT extracted"
        - "Constant 'ORDER_STATUS_UPDATED' â†’ NOT extracted"
        - "Real text 'Order Summary' â†’ still extracted"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # BUG-3: Duplicate key generation for already-translated content
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: BUG-3
    title: "Transform proposes new keys for text that already has translation keys"
    severity: high
    status: completed
    affects: [transform]
    frameworks: [react]
    
    evidence:
      description: |
        The transform-preview shows duplicate keys being created for content
        that already exists in the locale files with different key formats:
        
        Existing:   "...auth-claim-claimaccessfor.3aafb0": "Claim access for"
        Proposed:   "...claim-access-for.681afa": "Claim access for"
        
        Existing:   "...auth-claim-signedinas.833f24": "Signed in as"
        Proposed:   "...signed-in-as.9806ba": "Signed in as"
        
        Existing:   "...auth-claim-licensealreadyclaimederror.444dbd": "This license key..."
        Proposed:   "...this-license-key-is.7982a5": "This license key..."
        
        The scanner finds hardcoded fallback strings (from `t('key') || 'fallback'`
        patterns) and proposes to extract the fallback text as NEW keys, even though
        they already have proper translation keys.

    root_cause: |
      The scanner doesn't detect the `t('existing.key') || 'Fallback text'` pattern.
      It sees the 'Fallback text' string literal inside a JSX expression and treats
      it as a candidate for extraction. The existing key reference should suppress
      the fallback from being extracted.

    fix:
      approach: "Detect t() || 'fallback' pattern and suppress fallback extraction"
      
      changes:
        - file: packages/core/src/framework/ReactAdapter.ts
          what: "Skip fallback strings in t() || 'fallback' patterns"
          detail: |
            In scanJsxExpressions(), when processing string literals inside
            expressions, check if the string literal is the right-hand side of
            a `||` or `??` binary expression where the left side is a t() call.
            
            Detection: walk up from StringLiteral to BinaryExpression, check if
            operator is `||` or `??`, and left operand is a call to t/i18n/etc.
            
            If so, skip the string literal â€” it's a fallback for an already-keyed
            translation.
        
        - file: packages/core/src/framework/adapters/vue.ts
          what: "Same pattern detection for Vue script blocks"

      tests:
        - "t('key') || 'Fallback' â†’ 'Fallback' is NOT extracted"
        - "t('key') ?? 'Fallback' â†’ 'Fallback' is NOT extracted"
        - "standalone 'Real text' â†’ still extracted"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # BUG-7: Vue files with malformed template syntax are completely skipped
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: BUG-7
    title: "Vue adapter fails silently on malformed template syntax, skipping entire file"
    severity: critical
    status: completed
    affects: [transform, check, preview]
    frameworks: [vue]
    
    evidence:
      description: |
        GalleryComponent.vue contains multiple hardcoded translatable strings but
        appears completely skipped by i18nsmith. Analysis shows malformed Vue
        template syntax that likely causes vue-eslint-parser to fail, falling
        back to regex scanning which misses candidates.
        
        Malformed syntax examples:
        - `{{ $t('key') }}per ? 'âœ“' : 'âœ—' }}` (missing opening {{ for second interpolation)
        - `{{ $t('key') }}d }}` (similar malformed interpolation)
        
        Hardcoded strings that should be extracted:
        - "Property image" (in alt attributes)
        - "Thumbnail" (in alt attributes) 
        - "VR Preview" (in alt attribute)
        - "360Â°" (in span text content)
        - Template comments like "â”€â”€ Main slider â”€â”€" (should be skipped)
    
    root_cause: |
      The VueAdapter uses vue-eslint-parser for AST-based extraction, but falls
      back to regex-based scanning when parsing fails. Malformed template syntax
      causes parser failure, and the regex fallback is too conservative and misses
      valid translatable strings in attributes and text content.
      
      Parser failure occurs because:
      1. Invalid interpolation syntax breaks AST construction
      2. vue-eslint-parser throws errors on malformed templates
      3. Adapter falls back to basic regex that only finds obvious patterns
      4. Regex misses attribute values and complex template structures
      
      Additionally, the adapter should provide better error reporting when
      parsing fails, so users know their templates are malformed.

    fix:
      approach: "Improve parser error handling + enhance regex fallback + add syntax validation"
      
      changes:
        - file: packages/core/src/framework/adapters/vue.ts
          what: "Add syntax validation before parsing, report template errors"
          detail: |
            Before attempting AST parsing, validate basic Vue template syntax.
            Report specific syntax errors to user instead of silent failure.
            
        - file: packages/core/src/framework/adapters/vue.ts
          what: "Enhance regex fallback to catch attribute values and text content"
          detail: |
            When AST parsing fails, use more comprehensive regex patterns to
            find translatable strings in :alt, :title, and text content that
            AST parsing would normally find.
            
        - file: packages/core/src/framework/adapters/vue.ts
          what: "Add partial AST recovery for recoverable syntax errors"
          detail: |
            For common syntax errors (missing quotes, malformed interpolations),
            attempt to fix them before parsing, or parse partial AST segments.
      
      tests:
        - "Malformed interpolation syntax â†’ parser reports specific error instead of silent skip"
        - "Valid hardcoded strings in malformed template â†’ still extracted via enhanced fallback"
        - "Template with mixed valid/invalid syntax â†’ valid parts processed, errors reported"
        - "Well-formed Vue template â†’ normal AST processing works"
        
        test_cases_from_gallery_component:
          - "Malformed: `{{ $t('key') }}per ? 'âœ“' : 'âœ—' }}` â†’ reports syntax error, extracts 'âœ“' and 'âœ—' via fallback"
          - "Malformed: `{{ $t('key') }}d }}` â†’ reports syntax error, processes valid parts"
          - "Valid: `:alt=\"Property image ${index + 1}\"` â†’ extracts 'Property image'"
          - "Valid: `:alt=\"Thumbnail ${index + 1}\"` â†’ extracts 'Thumbnail'"
          - "Valid: `alt=\"VR Preview\"` â†’ extracts 'VR Preview'"
          - "Valid: `<span>360Â°</span>` â†’ extracts '360Â°'"
          - "Valid: `{{ $t('existing.key') }}` â†’ correctly skipped (already instrumented)"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PART 2 â€” BULK RENAME BUGS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

rename_bugs:

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # BUG-4: Bulk rename generates broken import + duplicate const
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: BUG-4
    title: "Bulk rename source file patch inserts broken import and duplicate binding"
    severity: critical
    status: completed
    affects: [rename, transform]
    frameworks: [react]
    
    evidence:
      description: |
        The bulk-rename-preview.txt shows this patch for activate-key-modal.tsx:
        
        ```diff
        +import { t } from '@i18nsmith/core';
        +
        +const { t } = t();
        ```
        
        This is doubly broken:
        1. It imports `t` from `@i18nsmith/core` â€” this is NOT the user's translation
           adapter. The config says: module: "@/contexts/translation-context", hookName: "useTranslation"
        2. It then does `const { t } = t()` which is a ReferenceError (t is not a
           function at this point, it was imported as a named export)
        3. The file ALREADY has `import { useTranslation } from '@/contexts/translation-context'`
           and a `const { t } = useTranslation()` â€” the rename should NOT add imports
    
    root_cause: |
      The mutate() method in ReactAdapter has import-injection logic that:
      1. Hardcodes '@i18nsmith/core' as fallback instead of reading config.translationAdapter
      2. Doesn't check if the import/hook already exists when generating rename diffs
      3. The regex for detecting existing hook (`hasHook`) may fail to match the
         existing pattern in the file

    fix:
      changes:
        - file: packages/core/src/framework/ReactAdapter.ts
          what: "Fix import injection to respect existing adapter + config"
          detail: |
            1. In ensureImportAndHook(), check if import already exists FIRST
            2. Read module/hookName from config.translationAdapter
            3. Never import from '@i18nsmith/core' â€” that's a tooling package,
               not a runtime translation library
            4. If hook already exists, skip injection entirely
            5. For rename operations, NEVER inject imports â€” only the actual
               key string replacement should happen

        - file: packages/transformer/src/transformer.ts
          what: "Pass 'isRename' flag to skip import injection during renames"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # BUG-5: Rename moves keys to wrong namespace
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: BUG-5
    title: "Suspicious key rename changes namespace based on new file path detection"
    severity: medium
    status: completed
    affects: [rename]
    frameworks: [react]
    
    evidence:
      description: |
        The bulk rename moves keys from `activateKey.*` to 
        `common.components.activate-key-modal.activatekey-*`:
        
        Old: "activateKey.goToSignIn" â†’ "Sign In"
        New: "common.components.activate-key-modal.activatekey-gotosignin.a3ad36" â†’ "Sign In"
        
        Old: "activateKey.processing" â†’ "Processing..."  
        New: "common.components.activate-key-modal.activatekey-processing.4ed07e" â†’ "Processing..."
        
        The values are identical â€” the translations are preserved. But:
        1. The new key format includes a hash suffix (.a3ad36) which is unnecessary
           for a rename (the text didn't change)
        2. The namespace changed from a short, clean `activateKey.` to a long
           file-path-based `common.components.activate-key-modal.` format
        3. This breaks ALL existing source code references to `activateKey.goToSignIn`
           across the project (not just in activate-key-modal.tsx)
    
    root_cause: |
      The suspicious-key-renamer generates new keys using the same key-generation
      algorithm as new extractions (file-path-based namespace + slug + hash).
      For renames, it should preserve the existing namespace structure and only
      clean up the key slug portion.

    fix:
      changes:
        - file: packages/core/src/suspicious-key-renamer.ts
          what: "Preserve namespace structure during renames"
          detail: |
            When generating a renamed key:
            1. Keep the original namespace prefix (e.g., "activateKey.")
            2. Only regenerate the key slug if the original is truly suspicious
            3. Don't append hash suffix for renames (text is unchanged)
            4. Offer a "preserve-namespace" option for bulk renames

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PART 3 â€” DYNAMIC KEYS ISSUES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

dynamic_keys_issues:

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # BUG-6: Dynamic keys require manual translation management
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: BUG-6
    title: "No tooling support for populating/validating dynamic key translations"
    severity: medium
    affects: [sync, check, transform]
    frameworks: [all]
    
    evidence:
      description: |
        The dynamic-keys-resolution report shows that:
        1. Keys matching `dynamicKeys.globs` patterns display as raw strings
           (e.g., "workingHours.sunday" shown literally in UI)
        2. Users must MANUALLY add translations for every variant of every glob
        3. No validation that all glob-matched keys have translations
        4. No way to enumerate what values a glob pattern should expand to
        5. Italian and French translations were incomplete (only partial coverage)
      
      patterns_needing_manual_management:
        - "workingHours.*" â†’ 9 variants (days + closed/open)
        - "restaurant.role*" â†’ multiple case variants (Owner, OWNER, owner)
        - "management.activityHistory.filters.*" â†’ 5 time-based variants
        - "management.bookings.status.*" â†’ 3 status variants
        - "payment.statuses.*" â†’ 5 status variants
        - "service.orderStatuses.*" â†’ multiple statuses
    
    fix:
      approach: "Add dynamic key expansion, validation, and scaffold commands"
      
      changes:
        - file: packages/core/src/dynamic-keys.ts (new)
          what: "Create dynamic key expansion engine"
          detail: |
            1. Add `dynamicKeys.expand` config option that maps glob patterns
               to their known values:
               ```json
               "dynamicKeys": {
                 "expand": {
                   "workingHours.*": ["monday","tuesday","wednesday","thursday",
                                      "friday","saturday","sunday","closed","open"],
                   "restaurant.role*": ["Owner","OWNER","owner","Manager","MANAGER"]
                 }
               }
               ```
            2. `i18nsmith check` validates that all expanded keys have translations
            3. `i18nsmith sync` can scaffold missing dynamic key translations
            4. Auto-detect common enum patterns from source code
        
        - file: packages/cli/src/commands/check.ts
          what: "Add dynamic key coverage report"
          detail: |
            When running `check`, report which dynamic key patterns have
            incomplete translation coverage across target locales.

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PART 4 â€” DEPRECATED CONFIG MIGRATION SYSTEM
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

deprecated_config:
  
  title: "Design deprecated config detection and cache invalidation system"
  
  motivation: |
    The user's config uses `targetLanguages` (which may be a legacy alias)
    and `locales` as an explicit map. Config fields may change across versions
    of i18nsmith, and stale caches from older config schemas can cause
    incorrect behavior (wrong candidates, phantom keys, broken previews).
  
  design:

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 4.1 Config Version Tracking
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - id: DEPR-1
      title: "Config schema versioning"
      detail: |
        Add a `configVersion` field to i18n.config.json that tools can check:
        ```json
        { "configVersion": 2, ... }
        ```
        When i18nsmith loads a config:
        1. If `configVersion` is missing â†’ treat as v1 (legacy)
        2. If `configVersion` < CURRENT_CONFIG_VERSION â†’ run migration
        3. Log warnings for deprecated fields
      
      deprecated_fields_v1_to_v2:
        - targetLanguages â†’ renamed to targetLocales
        - locales (explicit map) â†’ auto-derived from localesDir + targetLocales
        - translator.estimateOnly â†’ moved to translator.dryRun
        - safety.dryRunDefault â†’ moved to global dryRun option
      
      changes:
        - file: packages/core/src/config/types.ts
          what: "Add configVersion field, DeprecatedConfigWarning type"
        
        - file: packages/core/src/config/normalizer.ts
          what: "Add migration logic for deprecated fields"
          detail: |
            normalizeConfig() should:
            1. Detect deprecated field usage
            2. Emit warnings (returned as array, not console.log)
            3. Auto-migrate values to new field locations
            4. Write back migrated config if --fix flag is used

        - file: packages/core/src/config/migrator.ts (new)
          what: "Dedicated config migration module"
          detail: |
            ```typescript
            interface ConfigMigration {
              fromVersion: number;
              toVersion: number;
              migrate(config: any): { config: any; warnings: string[] };
            }
            
            const migrations: ConfigMigration[] = [
              { fromVersion: 1, toVersion: 2, migrate: migrateV1toV2 },
            ];
            ```

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 4.2 Automatic Cache Invalidation
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - id: DEPR-2
      title: "Cache invalidation on config change or tool update"
      detail: |
        Current state:
        - Reference cache lives at node_modules/.cache/i18nsmith/references.json
        - REFERENCE_CACHE_VERSION is manually bumped (currently 3)
        - Preview files live at .i18nsmith/previews/
        - No automatic cleanup on version upgrade
        
        Proposed design:
        1. Embed a content hash of the EFFECTIVE config (after normalization)
           into the cache file alongside the version number
        2. On any i18nsmith operation, compare:
           a. REFERENCE_CACHE_VERSION (code version)
           b. config content hash (config changes)
           c. i18nsmith package version (from package.json)
           If ANY mismatch â†’ invalidate entire cache
        3. Add a `postinstall` or "first run after update" hook that:
           a. Detects i18nsmith version change
           b. Clears: node_modules/.cache/i18nsmith/
           c. Clears: .i18nsmith/previews/
           d. Logs: "i18nsmith updated from X to Y â€” caches cleared"
      
      changes:
        - file: packages/core/src/reference-extractor.ts
          what: "Add config hash + package version to cache validation"
          detail: |
            ```typescript
            interface ReferenceCacheFile {
              version: number;
              configHash: string;      // NEW: SHA-256 of normalized config JSON
              toolVersion: string;     // NEW: i18nsmith package version
              fingerprints: Record<string, FileFingerprint>;
              references: Record<string, TranslationReference[]>;
            }
            ```
            
            On load: if configHash or toolVersion don't match â†’ invalidate.
        
        - file: packages/core/src/cache-manager.ts (new)
          what: "Centralized cache lifecycle manager"
          detail: |
            ```typescript
            export class CacheManager {
              constructor(private workspaceRoot: string, private config: I18nConfig) {}
              
              /** Clear all caches (references, previews, reports) */
              async clearAll(): Promise<void>;
              
              /** Check if caches are stale and need clearing */
              async isStale(): Promise<{ stale: boolean; reason?: string }>;
              
              /** Auto-clear if stale, return what was cleared */
              async autoInvalidate(): Promise<string[]>;
              
              /** Get cache health report */
              async getStatus(): Promise<CacheStatus>;
            }
            ```
        
        - file: packages/cli/src/commands/cache.ts (new)
          what: "Add `i18nsmith cache clear` and `i18nsmith cache status` commands"
        
        - file: packages/vscode-extension/src/extension.ts
          what: "Run cache invalidation on extension activation"
          detail: |
            On activation, check if the bundled CLI version changed since last run.
            If so, clear caches and notify user.

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 4.3 Deprecated Config User Warnings
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - id: DEPR-3
      title: "Surface deprecation warnings to users"
      detail: |
        Changes:
        1. CLI: Print yellow warnings at start of any command when deprecated
           config fields are detected
        2. VS Code: Show a one-time notification with "Migrate Config" action
           that auto-rewrites i18n.config.json
        3. Check command: Include deprecation warnings in report output
        
        Example warning:
        "âš ï¸  Config field 'targetLanguages' is deprecated. Use 'targetLocales' instead.
         Run 'i18nsmith config migrate' to update automatically."

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PART 5 â€” TEXT FILTER IMPROVEMENTS (long-term robustness)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

text_filter_improvements:

  - id: TF-1
    title: "Add comprehensive non-translatable pattern library"
    status: completed
    detail: |
      Create a curated set of patterns for common non-translatable content.
      These should be framework-agnostic and work for React, Vue, Angular, etc.
    
    patterns_to_add:
      # Identifiers & technical strings
      - name: "camelCase identifiers"
        pattern: '/^[a-z]+[A-Z][a-zA-Z]*$/'
        examples: ["categoryId", "isAvailable", "memberEmail", "orderNotes"]
      
      - name: "dot-notation paths"
        pattern: '/^[\w-]+(\.[\w-]+){2,}$/'
        examples: ["management.activityHistory.filters", "onboarding.payments.status"]
        note: "Must not match real sentences with periods"
      
      - name: "HTML input types"
        pattern: '/^(text|email|password|number|tel|url|date|time|hidden|submit|button|checkbox|radio|file|range|color|search)$/'
        context: "Only when inside type/inputMode attribute"
      
      - name: "HTTP methods and targets"
        pattern: '/^(GET|POST|PUT|DELETE|PATCH|_blank|_self|_parent|_top|noopener|noreferrer)$/'
      
      - name: "CSS keywords"
        pattern: '/^(auto|inherit|initial|unset|none|block|flex|grid|inline|bold|normal|center|left|right|baseline)$/'
        context: "Only when inside style-related attributes"
      
      - name: "Font family strings"
        pattern: '/^[\w\s,\-]+,\s*(sans-serif|serif|monospace|cursive|fantasy|system-ui)$/'
        examples: ["Helvetica, Arial, sans-serif"]
      
      - name: "Emoji-prefixed debug strings"
        pattern: '/^[\p{Emoji}].*:/u'
        examples: ["âœ… Logo updated from server:", "ğŸ“¤ Logo upload callback received URL:"]

  - id: TF-2
    title: "Context-aware filtering system"
    detail: |
      The current text filter is purely text-based. Many false positives can ONLY
      be eliminated with context (which JSX attribute, which component, etc.).
      
      Design:
      1. Extend TextFilterConfig with optional `context` field
      2. Add context-specific deny rules:
         - In `type` attribute â†’ deny all known HTML input types
         - In `className`/`class` â†’ deny everything (already handled by attr check)
         - In `style`/`d`/`viewBox` â†’ deny everything
         - In `icon`/`iconName` â†’ deny icon library patterns
         - In `href`/`to`/`action` â†’ deny URL-like strings
      3. Framework adapters pass context when calling shouldExtractText()

  - id: TF-3
    title: "Add 'confident extraction' scoring"
    detail: |
      Instead of binary extract/skip, assign a confidence score (0.0-1.0):
      - â‰¥0.8: auto-extract (high confidence â€” real user-visible text)
      - 0.4-0.8: needs-review bucket (might be translatable)
      - <0.4: auto-skip (technical string)
      
      Factors that increase confidence:
      - Contains spaces + mixed case (sentence-like)
      - Contains punctuation typical of sentences (.,!?)
      - Located in JSX text content (not attribute)
      - Parent element is a <p>, <h1>-<h6>, <span>, <label>, <button>
      
      Factors that decrease confidence:
      - All lowercase with dashes/underscores (identifier-like)
      - Contains colons followed by lowercase (namespace pattern)
      - Short (< 3 words) and matches known technical patterns
      - Inside a className, style, or data-* attribute

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PART 6 â€” IMPLEMENTATION PRIORITY & SEQUENCING
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

implementation_plan:

  phase_1_critical:
    title: "Stop the bleeding â€” fix false positives"
    priority: P0
    status: completed
    estimated_effort: "3-5 days"
    items:
      - BUG-1  # CSS/Tailwind class leak â€” blocks real usage
      - BUG-2  # Technical strings leak â€” same root cause area
      - BUG-4  # Broken import injection in rename
      - BUG-7  # Vue files silently skipped due to malformed syntax â€” blocks Vue usage
    outcome: |
      Transform preview goes from 2237 â†’ ~200-300 genuine additions.
      Rename preview produces valid source code patches.
      Vue files with translatable content are no longer silently skipped.

  phase_2_accuracy:
    title: "Improve extraction accuracy"
    priority: P1
    status: completed
    estimated_effort: "2-3 days"
    depends_on: [phase_1_critical]
    items:
      - BUG-3  # Duplicate keys for fallback text
      - BUG-5  # Rename namespace preservation
      - TF-1   # Non-translatable pattern library
    outcome: |
      Transform preview only shows genuinely new translatable strings.
      Renames preserve project's existing key structure.

  phase_3_robustness:
    title: "Long-term robustness"
    priority: P2
    estimated_effort: "3-4 days"
    depends_on: [phase_2_accuracy]
    items:
      - DEPR-1  # Config versioning
      - DEPR-2  # Cache invalidation
      - DEPR-3  # Deprecation warnings
      - TF-2    # Context-aware filtering
    outcome: |
      Config changes don't cause stale cache issues.
      Tool upgrades automatically clear incompatible caches.
      Users get clear guidance when using deprecated config.

  phase_4_features:
    title: "Dynamic keys and advanced scoring"
    priority: P3
    estimated_effort: "2-3 days"
    depends_on: [phase_3_robustness]
    items:
      - BUG-6  # Dynamic key expansion
      - TF-3   # Confidence scoring
    outcome: |
      Dynamic keys are fully managed by tooling.
      Preview shows confidence scores for borderline candidates.

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PART 7 â€” TEST PLAN
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

test_plan:

  framework_coverage_requirement: |
    For each feature/bug fix, test cases MUST be added for ALL supported frameworks
    (React, Vue, Angular, Svelte) to ensure global optima and prevent regressions.
    Each test fixture should have equivalent implementations across frameworks:
    
    - BUG-1 (CSS class leak): react-tailwind-heavy.tsx + vue-tailwind-heavy.vue + angular-tailwind-heavy.html + svelte-tailwind-heavy.svelte
    - BUG-2 (technical strings): react-svg-icons.tsx + vue-svg-icons.vue + etc.
    - BUG-3 (fallback patterns): react-fallback-patterns.tsx + vue-fallback-patterns.vue + etc.
    - BUG-7 (malformed templates): vue-malformed-syntax.vue + angular-malformed-syntax.html + etc.
    
    This ensures fixes work consistently across all frameworks and catches
    framework-specific regressions early.

  new_test_fixtures:
    - name: "react-tailwind-heavy.tsx"
      purpose: "File with extensive Tailwind classes in className attributes"
      covers: [BUG-1, BUG-2, TF-1]
    
    - name: "react-svg-icons.tsx"
      purpose: "File with SVG paths, icon libraries, CSS custom properties"
      covers: [BUG-2]
    
    - name: "react-fallback-patterns.tsx"
      purpose: "File with t('key') || 'fallback' patterns"
      covers: [BUG-3]
    
    - name: "react-existing-i18n.tsx"
      purpose: "File that already has translation imports and hook setup"
      covers: [BUG-4]
    
    - name: "vue-malformed-syntax.vue"
      purpose: "Vue file with malformed template syntax (missing {{, broken interpolations)"
      covers: [BUG-7]
      test_cases:
        - "Malformed interpolation: `{{ $t('key') }}per ? 'âœ“' : 'âœ—' }}` â†’ reports syntax error"
        - "Hardcoded alt text: `:alt=\"Property image ${index + 1}\"` â†’ extracts 'Property image'"
        - "Hardcoded span content: `<span>360Â°</span>` â†’ extracts '360Â°'"
        - "Already instrumented: `{{ $t('existing.key') }}` â†’ correctly skipped"
    
    - name: "vue-tailwind-heavy.vue"
      purpose: "Vue file with extensive Tailwind classes in class attributes"
      covers: [BUG-1, BUG-2, TF-1]
    
    - name: "vue-svg-icons.vue"
      purpose: "Vue file with SVG paths, icon libraries, CSS custom properties"
      covers: [BUG-2]
    
    - name: "vue-fallback-patterns.vue"
      purpose: "Vue file with t('key') || 'fallback' patterns in script and template"
      covers: [BUG-3]
    
    - name: "config-v1-legacy.json"
      purpose: "Config using all deprecated field names"
      covers: [DEPR-1, DEPR-2, DEPR-3]

  regression_tests:
    - description: "Transform of bilinmenu-like project produces <300 candidates (not 2237)"
    - description: "No CSS class strings appear in transform preview"
    - description: "No SVG path data appears in transform preview"
    - description: "Rename does not inject new imports into files with existing translation setup"
    - description: "Config with targetLanguages (deprecated) still works but warns"
    - description: "Cache is invalidated when config hash changes"
    - description: "Cache is invalidated when i18nsmith version changes"
